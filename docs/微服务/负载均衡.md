# 负载均衡

在[探活与数据同步](探活与数据同步.md)中，也就是分布式任务调度场景跟微服务负载均衡都面临怎么选择节点的问题。像轮询或者加权都是事前调度，比如将100个请求均匀的分发给10个服务，或者其中5个服务性能好，那这5个服务权重高就分的多一些。但是假如节点出现阻塞，负载均衡器是不知道的，所以能不能根据节点状态，动态的分发。要想获得节点状态，应该涉及 [Metric监控](Metric监控.md)。

[05 负载均衡：从状态的角度重新思考负载均衡](http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/05%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%EF%BC%9A%E4%BB%8E%E7%8A%B6%E6%80%81%E7%9A%84%E8%A7%92%E5%BA%A6%E9%87%8D%E6%96%B0%E6%80%9D%E8%80%83%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.md)，这篇文章的状态是说的请求带有状态，说的是请求有所侧重的路由到某些实例上。




##### 为什么需要负载均衡？
为了提升系统整体性能，采用[垂直扩展和水平扩展](https://www.jianshu.com/p/be66a52d2b9b)两种方式
1. 垂直扩展
	1. 增加单机硬件处理能力，增加 cpu、硬盘、内存等
2. 水平扩展
	1. [扩展多个节点](分布式.md#为什么引入分布式？带来了哪些问题？)，利用负载均衡分发请求
##### 负载均衡作用
1. 应对高并发，进行分流
2. [伸缩性](灰度发布.md)，添加或减少服务器进行分发控制
3. 高可用，监控候选服务，将请求分发给可用服务

### 负载均衡算法

[负载均衡算法 - 汇总 | Java 全栈知识体系](https://pdai.tech/md/algorithm/alg-domain-load-balance.html)
1. 随机访问
2. 轮询访问
3. 轮询加权
4. 随机加权
5. ip-hash


### 实现
##### 分类
按载体维度
1. 硬件：F5
2. 软件
	1. 服务端
		1. nginx, lvs, haproxy
		2. [负载神器 LVS、Nginx及HAProxy工作原理](https://mp.weixin.qq.com/s?__biz=MzU0MzQ5MDA0Mw==&mid=2247486255&idx=2&sn=37dd6b8479c0d95f21eef2f09711f9bf)
	2. 客户端：[ribbon](负载均衡.md#Ribbon)
按网络通信
1. cdn、dns、修改 ip、修改 mac
##### [Nginx](Nginx.md)
[Nginx](Nginx.md)

##### Ribbon
![ribbon](ribbon.md)

## reference
[深入浅出负载均衡](https://mp.weixin.qq.com/s/np_5Bjum8vO32GzZkdYDBg)