# 线上调优与排障
## 调优
### jvm 调优
[jvm调优排障](jvm调优排障.md)
### tomcat 调优
1.  [Tomcat和JVM的性能调优总结 - 腾讯云开发者社区-腾讯云](https://cloud.tencent.com/developer/article/1346964)

### nginx 调优

## 排障
1. [监控告警](Metric监控.md) 提前发现
2. cpu、内存、磁盘、网络硬件问题
3. 软件问题
	1. 中间件
	2. 业务系统
		1. 流量复制
		2. 远程 debug
		3. arthas
### dev 环境
#### idea 远程 debug
1. [SpringBoot远程调试](https://mp.weixin.qq.com/s?__biz=MzAwNjkxNzgxNg==&mid=2247487335&idx=2&sn=12f365d6e38792e3a94b7f9734fe1eee)
2. [IntelliJ IDEA 进行远程调试](https://mp.weixin.qq.com/s?__biz=Mzg3MjA4MTExMw==&mid=2247487495&idx=1&sn=56d9e35d8835f2118862dfa2e58a1bad)
3. [IDEA远程调试docker环境的SpringBoot项目](https://my.oschina.net/shuming/blog/4897179)

### prod 环境
 [怎么定位线上问题](https://mp.weixin.qq.com/s/g5dud7cXX2Rpivw_wQhQsw)
![](Pasted%20image%2020221107134530.png)
1.  [监控告警](Metric监控.md) 提前发现
2. 是业务代码还是中间件及服务器资源
3. 业务侧的话回滚版本
4. 运维配合查看 GC、服务器资源各个情况
[JAVA 线上故障排查完整套路](https://mp.weixin.qq.com/s?__biz=MzI5NTYwNDQxNA==&mid=2247486432&idx=1&sn=7ce4dfeeeb6f213eebabbdf34f435190)
线上故障主要包括
1. cpu
2. 内存
3. 磁盘
4. 网络
###### cpu
1. 死循环
2. 频繁 gc
3. 上下文切换过多
4. 使用工具 jstack

[解决线上问题](https://mp.weixin.qq.com/s/dNs6U4T4dG9RRJtXmNv0KQ)
bug 分类
系统级别
1. linux 命令
2.  perf 工具等几个命令

业务级别
1. 看日志
2. 看数据
3. 代码层面
#### 命令
[阿里排查 Java 问题工具命令清单]( https://mp.weixin.qq.com/s?__biz=MzU4Njc1MTU2Mw==&mid=2247485918&idx=1&sn=cef3f56889b98167c2d1602051a59b79 )

### 工具
#### jmh
JMH 是一个面向 Java 语言或者其他 Java 虚拟机语言的性能基准测试框架
1.  [Java 性能调优必备利器——JMH](https://mp.weixin.qq.com/s/LMVY6ZJPFCDtNpyBSyDW9A)
2. [Java神器--JMH & Arthas | BryantChang的博客](https://bryantchang.github.io/2019/12/08/java-profile-tools/)
3. [JMH - Java 微基准测试工具 - 掘金](https://juejin.cn/post/6844903936869007368)
#### arthas
[arthas](arthas.md)
#### jvm
[Java 调优排错 ThreadDump 分析实战，解读堆栈](https://mp.weixin.qq.com/s?__biz=MzU1MzUyMjYzNg==&mid=2247484880&idx=1&sn=9acba163de99ed07e7a779e9da155171)
Thread Dump 的后门帮助我们导出堆栈信息。借助线程堆栈会帮助我们迅速地缩小问题的范围， 找到突破口， 命中目标
[应用调试工具-火焰图 - 枕边书](https://zhenbianshu.github.io/2019/04/application_debug_tools_flamegraph.html)
大概是对 Thread Dump 可视化为火焰图
[jvm调优排障](jvm调优排障.md)




### 案例
1. [谈谈线上CPU100%排查套路 - 小小脑袋 - 博客园](https://www.cnblogs.com/open-source-java/p/11091255.html)
2. [CPU使用率飙升如何排查](https://mp.weixin.qq.com/s/woOxS85wyPM7P4ObTn2-0Q)
3. [mybatis引起的线程池线程打满问题排查过程](https://juejin.cn/post/7152379508354449439)

##### reference
[XSea全链路压测平台 | PerfMa 笨马网络](https://www.perfma.com/product/xsea)
[性能优化的 10 个技巧](https://mp.weixin.qq.com/s/injc5NccbkHY5ZvAhZu8OQ)





##### 怎么查看线程状态
1. idea  debug 能看到Thread Group
2. JVM 核心技术 32 讲

 