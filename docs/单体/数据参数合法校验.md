# 请求参数合法校验
##### 问题
1. 针对于浮点数的校验，比如大于 0.00 小于 9.99，@DecimalMin（value 类型为 string）、@Max (value 类型为 long)、@Range(value 类型为 long), 后边这俩根本就没法输入浮点数，第一个的注释里 `Note that {@code double} and {@code float} are not supported due to rounding errors   (some providers might provide some approximative support).`，实际测试也是支持的，具体是谁提供的呢？
	1. `DecimalMinValidatorForFloat`
	2. 在`org.hibernate.validator.internal.constraintvalidators`
 
##### 方式
1. validate
2. 第三方框架
	1. [Java的业务逻辑验证框架fluent-validator](http://neoremind.com/2016/02/java%e7%9a%84%e4%b8%9a%e5%8a%a1%e9%80%bb%e8%be%91%e9%aa%8c%e8%af%81%e6%a1%86%e6%9e%b6fluent-validator/)
	2. [GitHub - houbb/validator: 🚥Fluent-validation framework for java extend from hibernate-validator.（java 对象属性流式验证框架，下一代校验框架。兼容实现 jakarta bean validation、jsr 303、hibernate-validator）](https://github.com/houbb/validator)
3. 断言

### validate
1. spring validate 使用 `@Validated` 基于AOP 提供了 方法级别的参数校验，包括平铺参数和 pojo。
2. springMVC 使用  Valid 起头的注解  提供了对 `@RequestBody` 参数的校验
3. springMVC 并没有提供对平铺参数的校验，要借用 spring 提供的对平铺参数校验的能力。
4. 最终都是调用 hibernate validation 进行校验

##### 使用总结
[总结springmvc 中 validate 的使用](Spring%20Validation.md#springmvc%20中%20validate%20应用场景)
1. controller 上必须加 `@Validated`，满足 get 请求平铺参数 场景
2. get 请求 平铺参数前加校验注解如@min 等
3. get 请求，pojo 参数，参数前加 Valid 起头的注解
4. 对于@requestBody 的 post/put 请求，参数前加 Valid 起头的注解，有嵌套的 (pojo 或集合)，嵌套属性上加 `@Valid`
5. pojo 的 class 头上不需要加 `@Valid` 或者 `@Validated`
6. 校验一个是有没有这个值校验，再一个就是值内容校验。
	1. 可以利用值内容校验完成是否为空、为 null 的校验。比如利用 `@size (min=1)` 替代 `@NotBlank`
7. 与 [数据库字段大小](MySQL数据类型.md#mysql%20数据类型)限制统一
	1. 涉及类型转换的，比如入参是 int  数据库是 char
	2. 一一对应或者参数可能会加工
8. 在校验方法**入参**的约束时，约束注解（如@NotNull）不能放在实现类上，[fegin的继承](Feign.md#Fegin的继承)  
	1.  有接口继承情况，校验注解要写在接口层，[不然报错](https://blog.csdn.net/f641385712/article/details/97402946)
9.  在校验**返回值**时，接口和实现类都存在注解，以接口约束为准  

<span style="background:#A0CCF6">具体支持哪些类型看源码注释</span>
1. 值校验
2. 长度校验
	1. `@Length(max = 11, min = 7, message = "长度必须大于等于{min}或小于等于{max}")`；用于 ` String `，其长度必须在指定的范围内
	2. `@Size(max = 11, min = 7, message = "长度必须大于等于{min}或小于等于{max}")`；用于 String，Array，List，Map，其长度必须在指定的范围内
3. 范围校验
	1. @Max(value = 18, message = "必须大于等于18")
		1. 可用于数字（int，long，float，double）和字符串（字符串必须为数值型），其值必须小于等于指定的最大值
	2. @Min
	3. @DecimalMax(value = "150", message = "必须小于等于150")
		1. 注释写着由于舍入误差不支持 float 和 double，实际测试 float 可用
		2. 小于等于指定的值
	4. @DecimalMin
	5. @Range(max = 80, min = 18, message = "必须大于等于{min}或小于等于{max}")
		1. BigDecimal，BigInteger，CharSequence，byte，short，int，long；
		2. 验证注解的元素值在最小值和最大值之间
	6. @Past(message = "必须为过去的时间")
	7. @Future(message = "必须为未来的时间")
4. 格式校验
	1. @Digits(integer=3,fraction = 2,message = "整数位上限为3位，小数位上限为2位")
		1. float，double，BigDecimal
		2. 验证注解的元素值的整数位数和小数位数上限 
	2. @Pattern(regexp = "\\d{11}",message = "必须为数字，并且长度为11")
		1. String
		2. 被注解的元素必须符合指定的正则表达式
	3. @Email(message = "必须是邮箱")
		1. String
		2. 验证注解的元素值是 Email，也可以通过 regexp 和 flag 指定自定义的 email 格式
5. 嵌套校验
	1. pojo 嵌套 pojo
		1. 参数前加 `@Valid`
	2. 集合嵌套 pojo
		1. @Validated+@Valid
	3. 集合嵌套 `String`、`Integer` 等
		1. `List<@Size(max = 64)String>`
	4. [Spring Validation 校验集合新方法，竟然在泛型参数里加注解？？ - 掘金](https://juejin.cn/post/7044444094948458533)

## validate 体系
[bean validate -- 转载 - xj-record - 博客园](https://www.cnblogs.com/nxzblogs/articles/13995569.html)

#####  jsr303 
Java Bean Validation 1.0   13 个注解

| 注解         | 支持类型                               | 含义                                                       | null 值是否校验 |
|--------------|----------------------------------------|------------------------------------------------------------|----------------|
| @AssertFalse | bool                                   | 元素必须是 false                                            | 否             |
| @AssertTrue  | bool                                   | 元素必须是 true                                             | 否             |
| @DecimalMax  | Number 的子类型（浮点数除外）以及 String | 元素必须是一个数字，且值必须<=最大值                       | 否             |
| @DecimalMin  | 同上                                   | 元素必须是一个数字，且值必须>=最大值                       | 否             |
| @Max         | 同上                                   | 同上                                                       | 否             |
| @Min         | 同上                                   | 同上                                                       | 否             |
| @Digits      | 同上                                   | 元素构成是否合法（整数部分和小数部分）                     | 否             |
| @Future      | 时间类型 (包括 JSR310)                   | 元素必须为一个**将来**（不包含相等）的日期 (比较精确到毫秒) | 否             |
| @Past        | 同上                                   | 元素必须为一个**过去**（不包含相等）的日期 (比较精确到毫秒) | 否             |
| @NotNull     | any                                    | 元素不能为 null                                             | 是             |
| @Null        | any                                    | 元素必须为 null                                             | 是             |
| @Pattern     | 字符串                                 | 元素需符合指定的正则表达式                                 | 否             |
| @Size        | String/Collection/Map/Array            | 元素**大小**需在指定范围中                                 | 否             |


##### jsr349
注解个数没有增加
该规范是 2013 年完成的，伴随着 `Java EE 7` 一起发布，它就是我们比较熟悉的 Bean Validation 1.1。
Java Bean Validation 1.1 版本实现对应的是 Hibernate Validator 5.x (1.0 版本对应的是 4.x)

1.  标准化了Java平台的约束定义、描述、和验证
2.  **支持方法级验证(入参或返回值的验证)**
3.  Bean验证组件的依赖注入
4.  与上下文和DI依赖注入集成
5.  使用**EL表达式**的错误消息插值，让错误消息动态化起来（强依赖于ElManager）
6.  跨参数验证。比如密码和验证密码必须相同

##### jsr380
Java Bean Validation 2.0
新增了 9 个实用注解，总数到了 22 个

|注解             |支持类型 |含义                               |null 值是否校验 |
|--------------|--------------|--------------|--------------|
|@Email           |字符串   |元素必须为电子邮箱地址             |否             |
|@NotEmpty        |容器类型 |集合的 Size 必须大于 0                |是             |
|@NotBlank        |字符串   |字符串必须包含至少一个非空白的字符 |是             |
|@Positive        |数字类型 |元素必须为正数（不包括 0）          |否             |
|@PositiveOrZero  |同上     |同上（包括 0）                      |否             |
|@Negative        |同上     |元素必须为负数（不包括 0）          |否             |
|@NegativeOrZero  |同上     |同上（包括 0）                      |否             |
|@PastOrPresent   |时间类型 |在@Past 基础上包括相等              |否             |
|@FutureOrPresent |时间类型 |在@Futrue 基础上包括相等            |否             |

##### Java Bean Validation 3.0
Hibernate Validator 7.x
没有新特性，仅仅是改名去`javax.*`化

##### hibernate 扩充的注解
1. jsr
	1. javax.validation.constraints 包下，只提供规范不提供实现。
2. hibernate
	1. org.hibernate.validator.constraints 包下
3. spring
	1. org.springframework.validation  目测就只增加了一个@Vaidated
4. [深入了解数据校验（Bean Validation）：从深处去掌握@Valid的作用（级联校验）以及常用约束注解的解释说明](https://cloud.tencent.com/developer/article/1497733)
5. [java - Hibernate数据校验简介 - 个人文章 - SegmentFault 思否](https://segmentfault.com/a/1190000041015995)


##### 自定义 Validator
枚举值、固定值的校验
1. [自定义Validator](https://mp.weixin.qq.com/s?__biz=MzAwMTk4NjM1MA==&mid=2247503323&idx=1&sn=7eff61d135925a42b4d9f9aba86e10c7)

##### refrence
4. [你如何检查参数的合法性？](https://mp.weixin.qq.com/s/SBpe_lfoN1VGOsUrFgOGfA)
5. [我是怎么进行SpringMVC参数校验的？](https://mp.weixin.qq.com/s?__biz=MzIzMzgxOTQ5NA==&mid=2247487563&idx=1&sn=24a92a6185fd965fef49d68e7eb21301)
6. [Spring Boot实现通用的接口参数校验](https://juejin.cn/post/6844903604143259656)
8. [这么写参数校验(validator)就不会被劝退了~ - 掘金](https://juejin.cn/post/6844903902811275278)
9. [SpringBoot 中使用 @Valid 注解 + Exception 全局处理器优雅处理参数验证 | 小豆丁技术栈](http://www.mydlq.club/article/49/)
10. [Spring Boot + Nacos + Sentinel + 参数校验](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247492995&idx=1&sn=6f95c594c0bb9ac38c4f5cb346be765d)
11. [springboot 使用校验框架validation校验_双斜杠少年的博客-CSDN博客_springboot 参数校验](https://blog.csdn.net/u012373815/article/details/72049796)
12. [验证 | 凤凰架构](http://icyfenix.cn/architect-perspective/general-architecture/system-security/verification.html)

![Spring Validation](Spring%20Validation.md)


