# 双写一致性
##### 前提
1. 缓存一致性问题没有绝对可靠的方案，我们只能让两者尽量接近，但无论如何也不能百分百达到一致性效果。
2. 缓存和数据库，无论先处理谁，只要后者有延迟/失败，都会导致不一致的情况，这也正是缓存不一致的根本原因所在。所有解决方案和讨论都是围绕这一点来进行的。
##### 选择
1. 删缓存还是更新缓存？
	1. 删除，比更新简单，再就是有的缓存需要计算既耽误时间又容易出错。
	2. 会带来下一次查询cache miss，可能存在缓存击穿情况，通过加锁解决。
2. 先删后写还是先写后删
   1. 先删后写,会存在A删除缓存后，写入数据库未commit前，B读取数据库旧值放入缓存，导致以后所有请求读缓存都是旧值。采用延时双删解决，A在更新数据库成功后且B放入缓存后再次删除缓存。在mysql读写分离架构中，主从同步有时间差，B读取缓存未命中，要限制B去写库读取。
   2. 先写后删，缓存失效情况下，A读缓存未命中，读数据库后未写入缓存前，B写数据库删缓存，A写缓存，后续读都是旧值。
3. 删除缓存不成功怎么办？
   1. 引入Mq或者监听binlog

##### refrence
1. [数据库缓存一致性的问题](https://mp.weixin.qq.com/s/tpb6Xf4Vf6O6gxbZN3pWfA)
2. [缓存一致性问题解决方案](https://blog.csdn.net/bocai_xiaodaidai/article/details/124010396)
3. [Redis与MySQL双写一致性如何保证？](https://juejin.cn/post/6964531365643550751)
4. [如何保证缓存与数据库双写时的数据一致性？](https://www.jianshu.com/p/a8eb1412471f)
5. [缓存数据一致性探究](https://mp.weixin.qq.com/s/OWuP66WxpciBAgm2mptUxw)