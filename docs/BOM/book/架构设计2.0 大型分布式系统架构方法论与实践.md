##### 关于方法论 #方法论
1. 方法论的作用在遇到新业务、新问题时可以把之前分析和解决问题的方法迁移过来快速应用。
2. 关注点不是解决问题的具体技术或框架，而是问题本身及产生原因。提出问题、定义问题比解决问题更重要。
3. 最佳实践是某种特定场景下的最符合利益的解决方案。

# 分布式架构
##### 问题
1. 解决高并发问题的数据分片、任务分片、异步化等。
2. 解决高稳定性问题的各种策略：容量规划、[限流](限流.md)、[熔断](熔断.md)、降级等。
3. 数据并发更新的悲观锁、乐观锁、分布式锁。
4. 高可用架构中的网络超时、某个节点宕机的容错设计。
5. 分布式事务。
6. 多副本一致性问题。

##### 架构
1. 高并发
	1. 高并发读
		1. 场景： 搜索引擎、商品展示信息
		2. 策略： 其实本质上都是读写分离
			1. 动静分离，对静态资源缓存、cdn 加速
			2. 加缓存
				1. 本地缓存或集中式缓存
				2. 数据库读写分离
			3. 并发读与 pipeline
			4. 
	2. 高并发写
		1. 场景：广告扣费
		2. 策略：
			1. 数据分片
			2. 任务分片
			3. 异步化与 pipeline
			4. 批量
			5. 串行化 + 多进程单线程 + 异步 I/O 
	3. 高并发读写
		1. 场景：电商秒杀、抢红包
2. 高可靠
	1. 容量评估与规划
	2. 过载保护：[限流](限流.md)与[熔断](熔断.md)
	3. 超时与[[重试]]
	4. 隔离
	5. 有损服务与[[降级]]
	6. 灰度发布、备份与回滚
	7. 监控体系与日志报警
3. 数据一致性：[分布式事务](../../分布式/数据一致性/分布式事务.md)
	1. 哪里会出现分布式事务问题
		1. 缓存与数据库的一致性问题
		2. 消息中间件和数据库
		3. 分库后多个数据库之间
		4. 服务与数据库之间
		5. 服务与服务之间
		6. 总结：两个文件的一致性问题
			1. 一次请求的处理过程中，涉及两次写操作网络调用或者说涉及两次磁盘 io, 就无法保证这两次写操作同时成功，这也就是分布式事务问题。
			2. 单机版 mysql 的 redolog 和 binlog 一致性问题，也是分布式事务，通过两阶段提交解决
	2. 解决方案
		1. 2PC
		2. 最终一致性
		3. TCC
		4. 事务状态表 + 事务补偿
		5. 同步双写（多写）+ 异步对账
		6. 妥协方案：弱一致性 + 基于状态的事后补偿
		7. 妥协方案：重试 + 回滚 + 报警 + 人工修复
		8. 阿里 seata 
4. 高可用与容灾（多副本一致性）
	1. 高可用
		1. 高可用架构的思维框架
			1. 如何实现故障探测
			2. 如何解决脑裂问题
			3. 如何做到数据一致性
			4. 如何做到对客户端透明
			5. 如何解决高可用依赖的连环嵌套问题
		2. 接入层高可用
		3. 业务逻辑层（微服务层）高可用
		4. 存储层高可用
	2. 多副本一致性算法
		1. 高可用且强一致性到底有多难
		2. Paxos 算法
		3. Raft 算法
		4. Zab 算法
		5. 三种算法对比与工程实现
	3. 跨城容灾与异地多活
		1. 跨城关键物理约束：时延
		2. 多 IDC 无复制架构
		3. 同城同步复制，跨城异步复制：2 地 3 中心
		4. 跨城同步复制：3 地 5 中心
		5. 跨城异步复制
		6. 单元化
	4. CAP 理论
		1. 理论误解
		2. 现实世界不存在强一致性（pacelc 理论）

# 业务架构
##### 问题
1. 如何从技术延展到业务
2. 如何做需求分析、建模、领域驱动设计和微服务拆分
3. 业务与技术的融合之道

##### 架构
1. 业务架构定义
	沟通+抽象。关注技术架构所解决之外的问题。  
	1. 团队混乱 
		1. 业务边界不清晰，各个团队推诿扯皮 
	2. 系统混乱
		1. 业务边界不清晰，代码混乱。
		2. 业务代码黑盒，接手困难。  
	3. 研发效率
	4. 新技术带来的业务架构改进 
2. 现实世界的抽象
	1. 真正的需求
		1. 探究问题的本质
		2. 系统化思维
		3. 信息传播的递减效应
		4. 主要矛盾与次要矛盾
		5. 产品手段与技术手段的权衡
	2. 整体看待需求
		1. 看需求先看利益相关者
		2. 金字塔原理：不重不漏的拆解问题
		3. 需求的两种表现形式：业务流程与业务规则
		4. “业务”的闭环性
3. 不同粒度建模方法与原则
	1. 单个系统内
		1. 搭积木
		2. 面相对象
	2. 问题空间
		1. 深刻理解专业名词
		2. 重要信息显性化
		3. 抽象
	3. 解决方案空间
		1. 重构
		2. 设计模式
		3. SOLID
	4. 跨系统、跨团队
		1. 康威定律
		2. 领域的划分：高内聚与低耦合
		3. 边界思维
		4. 多视角描述同一个架构：4+1 5+1 视图
4. 常用架构模式
	1. 分层架构模式与伪分层
	2. 管道-过滤器
	3. 状态机
	4. 业务切面/业务闭环
	5. 规则引擎
	6. 工作流引擎
5. 领域驱动设计
	1. 传统面向数据库表的面条式代码开发模式
	2. DDD 基本概念
	3. 方法论
6. DDD 的折中与微服务架构
	1. 软件建模本身的困难
	2. "无建模"带来的各种问题
	3. DDD 的困难
	4. 折中后的 DDD
	5. 三个不同层次的读写分离架构
# 案例实战
1. 基础架构
	1. 分布式锁
	2. 服务注册与发现
	3. 分布式 ID 生成
2. C 端业务系统
	1. 电商库存
	2. 秒杀
	3. Feeds 流
3. B 端业务系统
	1. 规则引擎平台
	2. 工作流平台
	3. 权限管理系统
4. 大数据与中台
	1. 严格区分在线业务逻辑与离线业务逻辑
	2. 警惕后台离线任务
	3. 合理利用大数据交互式查询
	4. 中台
