# 大文件上传

>  解决思路都是分而治之，将任务按规则分割后，执行，最后验证。
##### 怎么分
大文件是对文件按固定大小进行等分并标有序号，这样更容易确定是哪部分数据，这部分数据包括哪些。
大批量数据可以进行分页，若不支持分页才可以利用其它参数进行划分（有可能不等分，如利用部门查员工）
##### 怎么传
大文件是前端并发请求，后端controller单例多线程处理。
##### 怎么存

## 前端上传
[GitHub - fex-team/webuploader: It's a new file uploader solution!](https://github.com/fex-team/webuploader)
[文件分片上传之前端文件分片\_Helloweba](https://www.helloweba.net/javascript/633.html)

[谈谈前端大文件分片上传 - 掘金](https://juejin.cn/post/7044503613418242055)
[大文件上传优化，断点续传，分片上传](https://segmentfault.com/a/1190000038408148)
[大文件如何做分片上传 - 掘金](https://juejin.cn/post/6991465343910690823)
[自学前端第N天，写了个文件分片上传](https://www.douyin.com/video/7284584501529840957)
1. 浏览器数据库 IndexedDB
2. [wasm到底能给js加多少分，文件获取md5 - 掘金](https://juejin.cn/post/7129446744080777224)
## 前端下载

[我是如何将一个加载90s的接口优化到不足2s的 - Erneste - 博客园](https://www.cnblogs.com/DDgougou/p/11371911.html)
### HTTP Range

[基于 HTTP Range 实现文件分片并发下载！ - 掘金](https://juejin.cn/post/7219140831365857317)
[前端多线程大文件下载实践](https://mp.weixin.qq.com/s/YphcF4QUP_2w7ZgLiO7EUA)
[图解：HTTP 范围请求，助力断点续传、多线程下载的核心原理 - 承香墨影 - 博客园](https://www.cnblogs.com/plokmju/p/http_range.html)

[README.zh-hans.md](https://github.com/lqzhgood/axios-multi-down/blob/main/README.zh-hans.md)
## 大文件上传
### 文件上传到本地
1. 前端如何分片
   1. 根据固定的大小对文件进行分片
2. 如何实现断点续传
   1. 前端从后端查询已经上传的分片数据，只上传未上传的分片数据
3. 如何实现秒传
   1. 计算md5
4. 如何写数据
   1. 前端上传时带有分片序号和大小
   2. 后端根据分片序号和大小计算开始位置，写入数据。（分片大小固定，注意最后一个分片逻辑）
####  deepblue
分为两部分，前者是前端上传到服务端本地，后者是服务端本地上传minio。
##### 校验MD5
文件上传前，前端计算文件MD5值作为参数
1. 后端查询minio是否有此文件，文件名为MD5值。
2. minio不存在，校验本地是否存在。利用redis存放本地文件状态。
##### 分片上传
1. 向completionService提交当前分片存储任务
   1. 执行写入操作，会根据当前片序号及分片大小计算偏移量写入文件。
   2. 将该分片写入本地文件记录，供判断是否上传成功。
   3. 判断是否已全部上传，将当前分片上传情况存入redis,md5值当key
   4. 返回总的上传结果，其中包含各分片上传情况
##### 代码
[Darling/springboot-slice-upload](https://gitee.com/darlingling/springboot-slice-upload.git)

参考自 [springboot实战之文件分片上传、断点续传、秒传](https://mp.weixin.qq.com/s?__biz=MzI1MTY1Njk4NQ==&mid=2247488124&idx=1&sn=5f61348c42f0cf665d65401907588391&chksm=e9eefc0ade99751cac543f1d4e6bc81ecbbebfbdf26f1215ad44699a7e115dc8a9237a971f9c&scene=21#wechat_redirect)

###### [JavaIO](BIONIOAIO.md#JavaIO%20访问)
1. MappedByteBuffer
	1. 使用虚拟内存，因此分配 (map)的内存大小不受JVM的-Xmx参数限制，但是也是有大小限制的。
2. RandomAccessFile
	1. 可以跳转到文件的任意位置处读写数据
	2. [Java IO流——RandomAccessFile（随机读写） - 邓维-java - 博客园](https://www.cnblogs.com/dw3306/p/14919025.html)

[大文件上传下载实现思路，分片、断点续传代码实现，以及webUpload组件](https://blog.csdn.net/weixin_52210557/article/details/124097574)
 [断点续传？文件秒传？手撸大文件上传实战](https://mp.weixin.qq.com/s/4tHS5XOn1NImtE-FHdFkmw)

### 本地上传到云端
[对接第三方](对接第三方.md#怎么封装对接第三方)
1. [代码参考](https://gitee.com/XYW1171736840/spring-file-storage)

[使用Spring AOP实现异步文件上传](https://mp.weixin.qq.com/s/fewV3bvnTiZ_Tj7SQrdw5Q)
