# 数值计算

## 为什么有精度丢失
对于计算机而言，0.1 无法精确表达，这是浮点数计算造成精度损失的根源。

0.1 的二进制表示为 0.0 0011 0011 0011… （0011 无限循环)，再转换为十进制就是 0.1000000000000000055511151231257827021181583404541015625。

## BigDecimal
BigDecimal 有 scale 和 precision 的概念，scale 表示小数点右边的位数，而 precision 表示精度，也就是有效数字的长度。
new BigDecimal(Double.toString(100)) 得到的 BigDecimal 的scale=1、precision=4；
而 new BigDecimal(“100”) 得到的 BigDecimal 的 scale=0、precision=3。
对于 BigDecimal 乘法操作，返回值的 scale 是两个数的 scale 相加。所以，初始化 100 的两种不同方式，导致最后结果的 scale 分别是 4 和 3。

1.  使用 BigDecimal 表示和计算浮点数，且务必使用字符串的构造方法来初始化 ,如果一定要用 Double 来初始化 BigDecimal 的话，可以使用 BigDecimal.valueOf 方法
2.  浮点数的字符串格式化也要通过BigDecimal 进行。
3.  equals 比较的是 BigDecimal 的 value 和 scale
4.  希望只比较 BigDecimal 的 value，可以使用 compareTo 方法_判断变量值是否为__0__，与__BigDecimal.ZERO__比较大小。_
5.   BigDecimal 的 equals 和 hashCode 方法会同时考虑 value 和 scale，如果结合 HashSet 或 HashMap 使用的话就可能会出现麻烦

第一个方法是，使用 TreeSet 替换 HashSet,TreeSet 不使用 hashCode 方法，也不使用 equals 比较元素，而是使用 compareTo 方法
第二个方法是，把 BigDecimal 存入 HashSet 或 HashMap 前，先使用 stripTrailingZeros 方法去掉尾部的零，比较的时候也去掉尾部的 0，确保 value 相同的 BigDecimal，scale 也是一致的


#### 数值计算还有一个要小心的点是溢出，不管是 int 还是 long，所有的基本数值类型都有超出表达范围的可能性.

方法一是，考虑使用 Math 类的 addExact、subtractExact 等 xxExact 方法进行数值运算，这些方法可以在数值溢出时主动抛出异常
方法二是，使用大数类 BigInteger。BigDecimal 是处理浮点数的专家，而 BigInteger 则是对大数进行科学计算的专家

1.  ROUND_UP
	1. 舍入远离零的舍入模式
	2. 在丢弃非零部分之前始终增加数字（始终对非零舍弃部分前面的数字加1）。
	3. 注意，此舍入模式始终不会减少计算值的大小。
2. ROUND_DOWN
	1. 接近零的舍入模式。
	2. 在丢弃某部分之前始终不增加数字（从不对舍弃部分前面的数字加1，即截短）。
	3. 注意，此舍入模式始终不会增加计算值的大小。
3. ROUND_CEILING
	1. 接近正无穷大的舍入模式。
	2. 如果 BigDecimal 为正，则舍入行为与 ROUND_UP 相同；
	3. 如果为负，则舍入行为与 ROUND_DOWN 相同。
	4. 注意，此舍入模式始终不会减少计算值。
4. ROUND_FLOOR
	1. 接近负无穷大的舍入模式。
	2. 如果 BigDecimal 为正，则舍入行为与 ROUND_DOWN 相同；
	3. 如果为负，则舍入行为与 ROUND_UP 相同。
	4. 注意，此舍入模式始终不会增加计算值。
5. ROUND_HALF_UP
	1. 向“最接近的”数字舍入，如果与两个相邻数字的距离相等，则为向上舍入的舍入模式。
	2. 如果舍弃部分 >= 0.5，则舍入行为与 ROUND_UP 相同；否则舍入行为与 ROUND_DOWN 相同。
	3. 注意，这是我们大多数人在小学时就学过的舍入模式（四舍五入）。
6. ROUND_HALF_DOWN
	1. 向“最接近的”数字舍入，如果与两个相邻数字的距离相等，则为上舍入的舍入模式。
	2. 如果舍弃部分 > 0.5，则舍入行为与 ROUND_UP 相同；否则舍入行为与 ROUND_DOWN 相同（五舍六入）。
7. ROUND_HALF_EVEN
	1. 向“最接近的”数字舍入，如果与两个相邻数字的距离相等，则向相邻的偶数舍入。
		如果舍弃部分左边的数字为奇数，则舍入行为与 ROUND_HALF_UP 相同；
		如果为偶数，则舍入行为与 ROUND_HALF_DOWN 相同。
		注意，在重复进行一系列计算时，此舍入模式可以将累加错误减到最小。
		此舍入模式也称为“银行家舍入法”，主要在美国使用。四舍六入，五分两种情况。
		如果前一位为奇数，则入位，否则舍去。
		以下例子为保留小数点1位，那么这种舍入方式下的结果。1.15>1.2 1.25>1.2
8. ROUND_UNNECESSARY
	断言请求的操作具有精确的结果，因此不需要舍入。
	如果对获得精确结果的操作指定此舍入模式，则抛出 ArithmeticException。


[MySQL数据类型](MySQL数据类型.md)